---
layout: post
title: "Hydra"
date: 2020-12-28 01:52:30 +300
image: hydra.svg
tags: open-source
---
Facebook Research에서 공개한 오픈소스. 복잡한 Configuration을 간단하고 깔끔하게 정리할 수 있는 장점이 있습니다.  
히드라(Hydra)라는 이름은 여러개의 유사한 작업을 수행할 수 있다는 점에서 하나의 몸에 여러 머리를 가진 히드라라는 이름으로 명명됐습니다.   
  
## Installation  
  
- Install Command
```
pip install hydra-core --upgrade
```

## Tutorials  
  
### A simple command-libe app  
  
가장 간단한 버젼의 hydra 사용법입니다.  
  
- my_app.py
```python
from omegaconf import DictConfig, OmegaConf
import hydra

@hydra.main()
def my_app(cfg: DictConfig) -> None:
    print(OmegaConf.to_yaml(cfg))

if __name__ == "__main__":
    my_app()
```
  
위의 예제 같이 다른 설정없이 실행한다면, Hydra는 아무것도 담지 않은 `cfg` 객체를 반환합니다.  
  
`+` 인자로 기존에 없던 config를 커맨드라인에서 추가해서 사용할 수 있습니다.    
  
```
$ python my_app.py +db.driver=mysql +db.user=omry +db.password=secret
db:
  driver: mysql
  user: omry
  password: secret
```
  
### Specifying a config file  
  
위의 방법과 같이 모든 아규먼트를 일일이 타이핑하는 것은 굉장히 지루하고 실수하기 쉬운 방법입니다. 이런 불편함을 해소하기 위해 YAML 포맷으로 config를 관리하는 방법이 있습니다.  
  
- config.yaml
```
db: 
  driver: mysql
  user: omry
  password: secret
```
    
yaml 포맷을 이용하는 경우 아까 위의 예제에서 `@hydra,main()`에 `config_name` 인자에 경로만 넘겨주면 됩니다.  
  
- my_app.py
```
@hydra.main(config_name='config')
def my_app(cfg):
    print(OmegaConf.to_yaml(cfg))
```
  
이렇게 config 파일 경로만 설정해주면 `config.yaml` 파일이 자동으로 로드되어 프로그램이 실행됩니다.  
  
```
$ python my_app.py
db:
  driver: mysql
  user: omry
  password: secret
```
  
### Using the config object
  
Hydra를 통해 얻은 `cfg`는 omegaconf 모듈의 DictConfig 객체입니다. 아래는 이러한 DictConfig를 다루는 간단한 예제입니다.  
  
- config.yaml
```
node:                         # Config is hierarchical
  loompa: 10                  # Simple value
  zippity: ${node.loompa}     # Value interpolation
  do: "oompa ${node.loompa}"  # String interpolation
  waldo: ???                  # Missing value, must be populated prior to access
```
  
- my_app.py
```python
@hydra.main(config_name="config")
def my_app(cfg: DictConfig):
    assert cfg.node.loompa == 10          # attribute style access
    assert cfg["node"]["loompa"] == 10    # dictionary style access

    assert cfg.node.zippity == 10         # Value interpolation
    assert isinstance(cfg.node.zippity, int)  # Value interpolation type
    assert cfg.node.do == "oompa 10"      # string interpolation

    cfg.node.waldo                        # raises an exception
```
  
Outputs:
```
$ python my_app.py 
Missing mandatory value: waldo
        full_key: waldo
        reference_type=Optional[Dict[Any, Any]]
        object_type=dict
```
  

